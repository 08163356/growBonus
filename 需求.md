

## 产品概述

GrowBonus（成长奖励）是一个移动端优先的家庭教育激励系统，为5岁小侄女量身打造。通过积分奖励正向行为、兑换奖品的方式，远程助力孩子成长。系统支持多角色协作（叔叔管理、父母录入、孩子互动），年预算3000元。

## 核心功能

### 1. 角色与权限体系

- 管理员（叔叔）：全部权限，管理奖品库、行为模板、查看成长报告、审批兑换
- 家长（父母）：按模板录入积分、查看成长报告、给孩子点赞鼓励
- 孩子（侄女）：查看积分和等级、浏览成就墙、兑换奖品（需大人确认）、查看奖品橱窗

### 2. 行为积分模板系统

- 预设四大类行为模板：生活习惯（1-2分）、学习技能（3-5分）、社交品格（5-8分）、特别成就（20-50分）
- 大人按模板快速打分，一键录入，可附带鼓励语
- 管理员可自定义新增/编辑/删除行为模板
- 通过模板固定分值控制积分通胀

### 3. 奖品商城与兑换

- 四档奖品：小奖（20分/约25元）、中奖（80分/约100元）、大奖（200分/约250元）、超级奖（500分/约625元）
- 支持物质奖励和非物质奖励（如"和叔叔视频通话30分钟"）
- 兑换需大人确认后生效
- 奖品橱窗展示，配合可爱图片和描述

### 4. 孩子端深度互动体验

- 卡通首页：展示当前积分、成长等级、角色动画（种子到开花的成长过程）
- 成就墙：展示获得的勋章和历史记录，网格式展示已解锁/未解锁状态
- 微动画激励效果（3-5秒）：获得积分时星星飞入、兑换时开宝箱、连续打卡角色成长
- 大按钮大图标，适合5岁孩子操作

### 5. 家庭互动与提醒

- 家人点赞鼓励功能
- 大人录入积分时可附带文字鼓励语
- 系统内提醒大人定期记录

### 6. 成长报告

- 周报/月报：积分趋势折线图、行为分类饼图、里程碑时间线
- 数据可视化图表展示

### 7. PWA 支持

- 可添加到手机桌面，接近原生 App 体验

## 技术栈

### 选型依据

沿用用户在 poetry-family-website 项目中已验证的成熟技术栈，降低开发和维护成本：

| 层级     | 技术选型                       | 说明                       |
| -------- | ------------------------------ | -------------------------- |
| 前端框架 | Vue 3 + TypeScript + Vite      | 用户已有 Vue3 项目经验     |
| 样式方案 | Tailwind CSS v4                | 用户已有 Tailwind 使用经验 |
| 状态管理 | Pinia                          | 用户已在 poetry 项目中使用 |
| 动画     | Lottie-web + CSS Animation     | 轻量JSON动画，体积小性能好 |
| 图表     | ECharts                        | 移动端友好的图表库         |
| PWA      | vite-plugin-pwa                | Vite 生态 PWA 方案         |
| 后端     | Node.js + Express + TypeScript | 用户已有同架构项目         |
| 数据库   | MongoDB + Mongoose             | 用户服务器已安装 MongoDB   |
| 认证     | JWT (jsonwebtoken + bcryptjs)  | 用户已有实践               |
| 部署     | Nginx + Systemctl              | 用户已有同模式部署经验     |

## 实现方案

### 整体策略

采用前后端分离的 monorepo 结构（frontend/ + backend/），严格复用 poetry-family-website 的 MVC 分层架构（controllers -> services -> models）。移动端优先设计，所有页面以手机视口为基准。

### 关键技术决策

1. ***\*Vue 3 而非 React\****：用户已有 Vue 3 + Pinia + Vue Router 的完整项目经验（poetry-family-website），复用相同技术栈可极大降低开发维护成本。

1. ***\*MongoDB 而非 PostgreSQL\****：用户服务器已安装 MongoDB，poetry 项目也使用 MongoDB + Mongoose，无需额外搭建。文档型数据库也非常适合行为记录、积分流水等半结构化数据。

1. ***\*Lottie-web 用于关键激励动画\****：JSON 动画文件体积小（10-50KB），渲染性能优于 GIF/视频，有丰富的免费卡通动画资源。仅在关键场景使用（获得积分、兑换奖品、连续打卡），不增加整体包体积。

1. ***\*PWA 而非原生 App / 小程序\****：用户有自己的服务器和域名，PWA 可直接部署，无需应用商店审核，添加到桌面后体验接近原生，开发成本最低。

1. ***\*单入口角色自适应\****：登录后根据角色自动展示对应界面（孩子端/大人端），通过路由守卫控制权限，避免维护多个独立应用。

### 数据模型设计

### 性能考量

- 积分流水表高频写入，建立 childId + createdAt 复合索引，保证查询效率
- 前端积分总数通过后端聚合接口返回，避免前端全量遍历计算
- Lottie 动画 JSON 文件懒加载，不影响首屏渲染
- 图片资源使用 WebP 格式 + 懒加载
- 积分记录列表数据量大时使用分页，前端不做无限滚动

## 实施注意事项

1. ***\*复用已有架构模式\****：严格参照 poetry-family-website 的目录结构和编码规范（controllers/services/models 分层，Pinia stores，Vue Router 路由组织方式，Axios 封装模式）
2. ***\*移动端适配\****：使用 Tailwind CSS 的移动优先响应式方案，触摸区域不小于 48px，避免 hover-only 交互
3. ***\*安全性\****：JWT 认证 + 角色中间件守卫；孩子端兑换操作后端二次校验大人确认状态；积分扣减使用 MongoDB 事务防止并发透支
4. ***\*部署对齐\****：复用 poetry 项目的部署模式（Nginx 反向代理 + Systemctl），使用不同端口（如 8003）和路径前缀（/growbonus）

## 架构设计

### 系统架构

### 页面路由架构

## 目录结构

采用 monorepo 结构，前后端分离，严格复用 poetry-family-website 的成熟架构。

```
growBonus/
├── frontend/                              # [NEW] Vue 3 前端应用
│   ├── public/
│   │   ├── icons/                         # [NEW] PWA 图标文件（多尺寸 192/512）
│   │   └── animations/                    # [NEW] Lottie JSON 动画文件（星星飞入/开宝箱/角色成长）
│   ├── src/
│   │   ├── assets/                        # [NEW] 静态资源（卡通背景/角色图片/勋章图标/默认奖品图）
│   │   ├── components/                    # [NEW] 组件目录
│   │   │   ├── common/                    # [NEW] 通用组件
│   │   │   │   ├── AppHeader.vue          # [NEW] 顶部导航栏，适配孩子端大字体卡通风和大人端简洁风
│   │   │   │   ├── BottomNav.vue          # [NEW] 底部tab导航栏，孩子端3tab（首页/成就/商城），大人端3tab（录入/管理/报告）
│   │   │   │   ├── LoadingSpinner.vue     # [NEW] 可爱卡通风加载动画
│   │   │   │   └── ConfirmDialog.vue      # [NEW] 确认弹窗组件，用于兑换确认等场景
│   │   │   ├── child/                     # [NEW] 孩子端专用组件
│   │   │   │   ├── PointsDisplay.vue      # [NEW] 积分大数字展示+星星环绕动画+等级信息
│   │   │   │   ├── LevelAvatar.vue        # [NEW] 等级成长角色（种子→小芽→小树→大树→开花→结果）
│   │   │   │   ├── AchievementBadge.vue   # [NEW] 勋章徽章，含解锁/未解锁状态和动效
│   │   │   │   ├── PrizeCard.vue          # [NEW] 奖品卡片展示+兑换按钮
│   │   │   │   └── RewardAnimation.vue    # [NEW] Lottie激励动画播放器（星星飞入/开宝箱/花朵绽放）
│   │   │   └── admin/                     # [NEW] 大人端专用组件
│   │   │       ├── QuickScoreCard.vue     # [NEW] 行为模板快速打分卡片
│   │   │       ├── TemplateForm.vue       # [NEW] 行为模板新增/编辑表单
│   │   │       ├── PrizeForm.vue          # [NEW] 奖品新增/编辑表单
│   │   │       ├── RedemptionItem.vue     # [NEW] 兑换审批卡片（通过/拒绝操作）
│   │   │       └── StatChart.vue          # [NEW] ECharts 统计图表（折线图/饼图）
│   │   ├── views/                         # [NEW] 页面视图
│   │   │   ├── LoginView.vue              # [NEW] 登录页：角色选择+密码/PIN输入
│   │   │   ├── child/                     # [NEW] 孩子端页面
│   │   │   │   ├── ChildHome.vue          # [NEW] 孩子首页：积分展示+等级角色+最近记录+家人鼓励
│   │   │   │   ├── AchievementWall.vue    # [NEW] 成就墙：勋章网格+解锁详情
│   │   │   │   └── PrizeShop.vue          # [NEW] 奖品商城：分档展示+兑换流程+开宝箱动画
│   │   │   └── admin/                     # [NEW] 大人端页面
│   │   │       ├── ScoreEntry.vue         # [NEW] 积分录入：分类模板卡片+快速打分+鼓励语
│   │   │       ├── ManageCenter.vue       # [NEW] 管理中心：模板管理/奖品管理/兑换审批 Tab切换
│   │   │       └── GrowthReport.vue       # [NEW] 成长报告：周报月报+趋势折线图+分类饼图
│   │   ├── router/
│   │   │   └── index.ts                   # [NEW] 路由配置+角色守卫+登录态检查
│   │   ├── stores/
│   │   │   ├── auth.ts                    # [NEW] 认证状态：token/用户信息/角色/登录登出
│   │   │   ├── points.ts                  # [NEW] 积分状态：总积分/记录列表/录入/动画触发
│   │   │   ├── prizes.ts                  # [NEW] 奖品状态：奖品列表/兑换操作/审批
│   │   │   └── achievements.ts            # [NEW] 成就状态：成就列表/解锁状态/通知
│   │   ├── services/
│   │   │   ├── api.ts                     # [NEW] Axios 实例：baseURL/JWT拦截器/错误处理
│   │   │   ├── authService.ts             # [NEW] 认证API
│   │   │   ├── pointService.ts            # [NEW] 积分API
│   │   │   ├── prizeService.ts            # [NEW] 奖品API
│   │   │   ├── templateService.ts         # [NEW] 行为模板API
│   │   │   ├── achievementService.ts      # [NEW] 成就API
│   │   │   └── reportService.ts           # [NEW] 报告统计API
│   │   ├── types/
│   │   │   └── index.ts                   # [NEW] 全局TS类型（User/Template/Record/Prize/Achievement等）
│   │   ├── utils/
│   │   │   ├── constants.ts               # [NEW] 常量（分类/档位/等级阈值/角色枚举）
│   │   │   └── helpers.ts                 # [NEW] 工具函数（积分格式化/等级计算/日期处理）
│   │   ├── App.vue                        # [NEW] 根组件+全局动画覆盖层
│   │   ├── main.ts                        # [NEW] 入口：Vue/Pinia/Router/PWA 初始化
│   │   └── style.css                      # [NEW] 全局样式+Tailwind导入+动画keyframes
│   ├── index.html                         # [NEW] HTML入口+PWA meta
│   ├── package.json                       # [NEW] 前端依赖
│   ├── vite.config.ts                     # [NEW] Vite配置+PWA插件
│   ├── tailwind.config.js                 # [NEW] Tailwind卡通主题
│   ├── postcss.config.js                  # [NEW] PostCSS配置
│   ├── tsconfig.json                      # [NEW] TS主配置
│   ├── tsconfig.app.json                  # [NEW] 应用TS配置
│   └── tsconfig.node.json                 # [NEW] Node TS配置
├── backend/                               # [NEW] Express 后端服务
│   ├── src/
│   │   ├── config/
│   │   │   └── index.ts                   # [NEW] 环境变量加载+配置导出
│   │   ├── middleware/
│   │   │   ├── auth.ts                    # [NEW] JWT认证中间件
│   │   │   └── roleGuard.ts               # [NEW] 角色权限守卫中间件
│   │   ├── models/
│   │   │   ├── User.ts                    # [NEW] 用户模型
│   │   │   ├── BehaviorTemplate.ts        # [NEW] 行为模板模型
│   │   │   ├── PointRecord.ts             # [NEW] 积分记录模型（含复合索引）
│   │   │   ├── Prize.ts                   # [NEW] 奖品模型
│   │   │   ├── Redemption.ts              # [NEW] 兑换记录模型
│   │   │   ├── Achievement.ts             # [NEW] 成就模型
│   │   │   ├── UserAchievement.ts         # [NEW] 用户成就关联模型
│   │   │   └── Like.ts                    # [NEW] 点赞模型
│   │   ├── controllers/
│   │   │   ├── authController.ts          # [NEW] 认证控制器
│   │   │   ├── pointController.ts         # [NEW] 积分控制器（录入/查询/汇总/点赞）
│   │   │   ├── prizeController.ts         # [NEW] 奖品控制器（CRUD/兑换/审批）
│   │   │   ├── templateController.ts      # [NEW] 行为模板控制器
│   │   │   ├── achievementController.ts   # [NEW] 成就控制器
│   │   │   └── reportController.ts        # [NEW] 报告统计控制器
│   │   ├── services/
│   │   │   ├── authService.ts             # [NEW] 认证服务
│   │   │   ├── pointService.ts            # [NEW] 积分服务（含成就检测触发）
│   │   │   ├── prizeService.ts            # [NEW] 奖品服务（兑换事务/库存管理）
│   │   │   ├── achievementService.ts      # [NEW] 成就服务（条件检测/自动解锁）
│   │   │   └── reportService.ts           # [NEW] 报告服务（MongoDB聚合管道）
│   │   ├── routes/
│   │   │   ├── index.ts                   # [NEW] 路由汇总挂载到 /api
│   │   │   ├── authRoutes.ts              # [NEW] 认证路由
│   │   │   ├── pointRoutes.ts             # [NEW] 积分路由
│   │   │   ├── prizeRoutes.ts             # [NEW] 奖品路由
│   │   │   ├── templateRoutes.ts          # [NEW] 模板路由
│   │   │   ├── achievementRoutes.ts       # [NEW] 成就路由
│   │   │   └── reportRoutes.ts            # [NEW] 报告路由
│   │   ├── scripts/
│   │   │   └── seed.ts                    # [NEW] 数据初始化：预设用户/行为模板/奖品/成就
│   │   ├── types/
│   │   │   └── index.ts                   # [NEW] 后端类型定义
│   │   └── index.ts                       # [NEW] Express入口+中间件+路由+MongoDB连接
│   ├── .env.example                       # [NEW] 环境变量示例
│   ├── package.json                       # [NEW] 后端依赖
│   └── tsconfig.json                      # [NEW] 后端TS配置
├── deploy/                                # [NEW] 部署配置
│   ├── nginx-growbonus.conf               # [NEW] Nginx配置片段
│   ├── growbonus-backend.service          # [NEW] Systemctl服务配置
│   └── deploy.sh                          # [NEW] 部署脚本
├── scripts/
│   └── build-and-pack.ps1                 # [NEW] PowerShell构建打包脚本
├── README.md                              # [NEW] 项目文档
└── package.json                           # [NEW] 根目录脚本入口
```

## 关键类型定义

```
// === 角色与分类枚举 ===
enum UserRole { ADMIN = 'admin', PARENT = 'parent', CHILD = 'child' }
enum BehaviorCategory { LIFE = 'life', LEARN = 'learn', SOCIAL = 'social', ACHIEVEMENT = 'achievement' }
enum PrizeTier { SMALL = 'small', MEDIUM = 'medium', LARGE = 'large', SUPER = 'super' }
enum RedemptionStatus { PENDING = 'pending', APPROVED = 'approved', REJECTED = 'rejected', FULFILLED = 'fulfilled' }

// === 核心接口 ===
interface IUser {
  _id: string; name: string; role: UserRole;
  avatar: string; pin?: string; // 孩子用4位PIN码
}

interface IBehaviorTemplate {
  _id: string; name: string; category: BehaviorCategory;
  points: number; icon: string; description: string; isActive: boolean;
}

interface IPointRecord {
  _id: string; childId: string; templateId: string;
  points: number; note?: string; encouragement?: string;
  createdBy: string; createdAt: Date;
}
```

## 设计风格

采用可爱卡通风格，柔和暖色系配色，圆润的 UI 元素，大按钮大图标，专为5岁小朋友设计。整体氛围温暖、活泼、充满童趣。大人端保持清晰易用，操作高效。

### 设计原则

- 孩子端：超大触摸区域（最小 48px），丰富色彩和动画，用图形代替文字，操作路径极简（最多2步完成任何操作）
- 大人端：简洁高效，信息密度适中，一键完成高频操作
- 全局：移动端优先，以 375px 宽度为基准设计

## 页面设计

### 页面1：登录页（LoginView）

- 顶部区域（40%屏高）：可爱卡通太阳角色，带轻微浮动呼吸动画，背景浅奶黄色渐变
- 中间角色选择区：3张大圆角卡片横向排列——"宝贝"（粉色星星图标）、"爸爸妈妈"（蓝色爱心图标）、"叔叔"（绿色皇冠图标），选中状态放大+光晕
- 底部输入区：孩子选择后显示4位数字大键盘 PIN 输入，大人选择后显示普通密码输入框+登录按钮
- 背景装饰：底部点缀彩色圆点和浮动云朵

### 页面2：孩子首页（ChildHome）

- 顶部栏：左侧圆形卡通头像+昵称（大字），右侧小铃铛图标
- 积分气泡区：居中大圆形渐变气泡（橙黄色），内显超大积分数字，外围小星星环绕旋转动画，下方等级标签（如"小树苗 Lv.3"）
- 成长角色区：卡通角色展示，随等级从种子逐步成长为大树开花，高约 120px
- 最近记录区：横向可滑动卡片列表，每张卡片含行为图标+名称+积分+时间，新记录有 NEW 徽章
- 家人鼓励区：底部气泡展示最近的点赞和鼓励语
- 底部导航：3个大圆角 tab 图标——首页（小房子）、成就（奖杯）、商城（礼物盒），选中态带颜色填充

### 页面3：成就墙（AchievementWall）

- 顶部标题："我的勋章墙"，右侧显示"已获得 X/Y 枚"
- 勋章网格：3列圆形网格，已解锁勋章彩色发光+微弹跳动画，未解锁灰色半透明+小锁图标
- 勋章详情弹窗：点击弹出卡片，大勋章图+名称+获得条件+获得时间
- 底部激励文案："再坚持X天就能获得XX勋章啦！"

### 页面4：奖品商城（PrizeShop）

- 顶部积分显示：星星图标+当前可用积分数，背景渐变条
- 分档标签栏：横向 tab（小奖/中奖/大奖/超级奖），每个 tab 配对应 emoji
- 奖品网格：2列大圆角卡片，每张含奖品大图、名称、所需积分（星星+数字），足够积分时兑换按钮高亮橙色，不够时灰色+提示"还差X分"
- 兑换动画流程：点击兑换->确认弹窗->3-5秒开宝箱 Lottie 动画->成功提示"已提交，等大人确认哦"

### 页面5：积分录入（ScoreEntry）

- 顶部信息栏：孩子头像+名称+当前总积分，今日已录入次数小徽章
- 分类 tab：4个横向标签（生活习惯/学习技能/社交品格/特别成就），各配分类颜色和图标
- 行为模板网格：2列卡片，每张含行为图标+名称+积分值，点击弹出录入确认弹窗
- 录入弹窗：行为名+积分显示+鼓励语输入框（可选）+确认按钮
- 今日记录：底部可折叠列表，展示今日已录入记录，支持长按撤销

### 页面6：管理中心+成长报告（ManageCenter + GrowthReport）

- Tab 导航：模板管理/奖品管理/兑换审批/成长报告
- 模板管理：列表卡片+右上角新增按钮，编辑表单含分类选择/名称/积分/图标
- 奖品管理：列表卡片+新增，表单含名称/积分/档位/图片上传/类型（物质/非物质）
- 兑换审批：待审批卡片（孩子头像+奖品名+积分+时间），通过/拒绝按钮
- 成长报告：周报/月报切换，顶部积分总览卡片（本周积分/对比上周），中部 ECharts 折线图（日积分趋势），底部饼图（行为分类占比）

## Agent Extensions

### MCP

- ***\*wecom-hil\****
- 用途：在开发关键里程碑完成后，通过企业微信通知用户开发进度（如后端API就绪、前端页面完成等）
- 预期效果：用户可在手机端及时了解项目开发进展，快速验证和反馈